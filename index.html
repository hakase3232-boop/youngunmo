<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>네이버 카페로 이동 중...</title>

    <link rel="manifest" href="/youngunmo/manifest.json">
    <link rel="apple-touch-icon" href="/youngunmo/images/icon-192.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <button id="installButton" style="display: none;">앱 설치하기</button>
    <p>네이버 카페로 이동 중입니다...</p>

    <script>
        let deferredPrompt; // PWA 설치 이벤트를 저장할 변수

        // 1. PWA가 이미 설치되었는지 확인하고 바로 리디렉션
        // PWA로 실행되었을 때, window.matchMedia를 통해 'standalone' 모드를 감지
        if (window.matchMedia('(display-mode: standalone)').matches) {
            window.location.href = "https://cafe.naver.com/truckerking";
        }

        // 2. 서비스 워커 등록
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/youngunmo/service-worker.js');
            });
        }

        // 3. '앱 설치하기' 버튼 이벤트
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installButton = document.getElementById('installButton');
            installButton.style.display = 'block';

            installButton.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('사용자가 PWA 설치를 승인했습니다.');
                    } else {
                        console.log('사용자가 PWA 설치를 거절했습니다.');
                    }
                    deferredPrompt = null;
                });
            });
        });

        // 4. 앱이 설치되면 버튼 숨김
        window.addEventListener('appinstalled', () => {
            document.getElementById('installButton').style.display = 'none';
        });

        // 5. PWA가 설치되지 않은 경우, 3초 후 리디렉션 (사용자 참여 유도)
        if (!window.matchMedia('(display-mode: standalone)').matches) {
            setTimeout(function() {
                window.location.href = "https://cafe.naver.com/truckerking";
            }, 1000000);
        }
    </script>
</body>
</html>
