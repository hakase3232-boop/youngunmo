<script>
    const CAFE_URL = "https://cafe.naver.com/truckerking"; 
    const userAgent = navigator.userAgent.toLowerCase();
    const isIos = /iphone|ipad|ipod/.test(userAgent);
    const isNaverApp = userAgent.indexOf('naver') !== -1;
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

    // 1. Ïù¥ÎØ∏ Ïï±ÏúºÎ°ú Ï†ëÏÜç Ï§ëÏù¥Î©¥ Ïπ¥ÌéòÎ°ú Î∞îÎ°ú Ïù¥Îèô
    if (isStandalone) { window.location.replace(CAFE_URL); }

    if (isIos) {
        document.getElementById('iphoneSection').style.display = 'block';
    } else if (isNaverApp) {
        document.getElementById('naverSection').style.display = 'block';
        document.getElementById('goToChrome').onclick = () => {
            location.href = "intent://" + location.host + location.pathname + "#Intent;scheme=https;package=com.android.chrome;end";
        };
    } else {
        document.getElementById('androidSection').style.display = 'block';
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            document.getElementById('installButton').onclick = () => { e.prompt(); };
        });
        // ÏïàÎìúÎ°úÏù¥Îìú ÏùºÎ∞ò Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú 5Ï¥à ÌõÑ ÏûêÎèô Ïù¥Îèô (ÏÑ†ÌÉùÏÇ¨Ìï≠)
        setTimeout(() => { if(!isStandalone && !isIos) window.location.href = CAFE_URL; }, 5000);
    }

    // 2. ÏïÑÏù¥Ìè∞ ÏÑ§Ïπò Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
    document.getElementById('installProfile').onclick = function() {
        // UUID ÏÉùÏÑ±Í∏∞ (HTTPSÍ∞Ä ÏïÑÎãàÏñ¥ÎèÑ ÏûëÎèôÌïòÎèÑÎ°ù Ìò∏ÌôòÏÑ± ÌôïÎ≥¥)
        const getUUID = () => {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };

        const uuid1 = getUUID();
        const uuid2 = getUUID();

        // --- [Ï£ºÏùò] Ïó¨Í∏∞Ïóê Base64 Îç∞Ïù¥ÌÑ∞Î•º ÎÑ£ÏúºÏÑ∏Ïöî ---
        let iconRaw = `iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABV7OTTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAB7JSURBVHja7Z15fBvVtf9/Z0Yja7clS7Ylb/Im3mInTuzYThonZCHpS0uhtEChL6X90vdbXp6H0vK09At96SstL6X0pS0U8pYmS9uSkhAnTuI43mI73m3JsiVrtpE0M+f3R9IsW7IlW7Y0M6P5vF+vfmXOzD1X9p25555z7rmXEEIgk8lYArIDZDIZAZDJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGAJRJZARAmUxGA`; 
        
        // Í≥µÎ∞±, Ï§ÑÎ∞îÍøà, data:image... Îì± Ìó§Îçî Ï†úÍ±∞ (ÏàúÏàò Îç∞Ïù¥ÌÑ∞Îßå ÎÇ®ÍπÄ)
        const iconBase64 = iconRaw.replace(/(\r\n|\n|\r| )/gm, "").replace(/^data:image\/(png|jpg|jpeg);base64,/, "");

        const profileContent = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>PayloadContent</key>
    <array>
        <dict>
            <key>FullScreen</key><true/>
            <key>IsRemovable</key><true/>
            <key>Label</key><string>ÏòÅÏö¥Î™®</string>
            <key>PayloadDisplayName</key><string>ÏòÅÏö¥Î™®</string>
            <key>PayloadIdentifier</key><string>com.youngunmo.shortcut</string>
            <key>PayloadType</key><string>com.apple.webClip.managed</string>
            <key>PayloadUUID</key><string>${uuid1}</string>
            <key>PayloadVersion</key><integer>1</integer>
            <key>URL</key><string>${CAFE_URL}</string>
            <key>Icon</key><data>${iconBase64}</data>
        </dict>
    </array>
    <key>PayloadDisplayName</key><string>ÏòÅÏö¥Î™® Î∞îÎ°úÍ∞ÄÍ∏∞ ÏÑ§Ïπò</string>
    <key>PayloadIdentifier</key><string>com.youngunmo.profile</string>
    <key>PayloadType</key><string>Configuration</string>
    <key>PayloadUUID</key><string>${uuid2}</string>
    <key>PayloadVersion</key><integer>1</integer>
</dict>
</plist>`;

        const blob = new Blob([profileContent], { type: 'application/x-apple-aspen-config' });
        const url = window.URL.createObjectURL(blob);
        
        document.getElementById('guideText').innerHTML = "üì• Îã§Ïö¥Î°úÎìú Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî!";

        const a = document.createElement('a');
        a.href = url;
        a.download = 'youngunmo.mobileconfig';
        document.body.appendChild(a);
        a.click();
        
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            document.getElementById('guideText').innerHTML = "‚úÖ [ÌóàÏö©] ÌÅ¥Î¶≠ ÏôÑÎ£å ÌõÑ,<br>[ÏÑ§Ï†ï] Ïï± Îß® ÏúÑÏóêÏÑú ÏÑ§ÏπòÎ•º ÎßàÎ¨¥Î¶¨ÌïòÏÑ∏Ïöî!";
        }, 500);
    };
</script>
