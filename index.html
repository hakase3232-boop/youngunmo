<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ìš´ëª¨ ë°”ë¡œê°€ê¸° ì„¤ì¹˜</title>
    <style>
        body { font-size: 1.5rem; font-family: 'Malgun Gothic', sans-serif; text-align: center; padding: 50px 20px; line-height: 1.6; background-color: #f5f5f5; color: #333; }
        .big-btn { font-size: 1.8rem; font-weight: bold; padding: 20px 40px; color: white; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.2); width: 100%; max-width: 400px; margin-top: 20px; }
        #androidSection button, #naverSection button { background-color: #03cf5d; }
        #iphoneSection button { background-color: #007aff; }
        .content-section { display: none; }
        #iphoneSection { background: white; border: 4px solid #007aff; border-radius: 20px; padding: 20px; margin-top: 20px; }
        #iosInAppNotice { display:none; margin-top:20px; padding:20px; background:#fff; border:3px solid #007aff; border-radius:20px; }
        .small-text { font-size: 1rem; color: #666; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="main-content">
        <h2 style="font-size: 2.2rem; margin-bottom: 10px; color: #03cf5d;">ì˜ìš´ëª¨ ì¹´í˜</h2>
        
        <div id="androidSection" class="content-section">
            <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.</p>
            <button id="installButton" class="big-btn">ì˜ìš´ëª¨ ì•± ì„¤ì¹˜í•˜ê¸°</button>
        </div>

        <div id="naverSection" class="content-section">
            <p id="appNotice">âš ï¸ ë¸Œë¼ìš°ì € í™˜ê²½ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <button id="goToChrome" class="big-btn">ì„¤ì¹˜ ë¸Œë¼ìš°ì €ë¡œ ì´ë™</button>
            
            <div id="iosInAppNotice">
                <p style="color:#007aff; font-weight:bold; font-size:1.3rem;">ğŸ ì•„ì´í° ì‚¬ìš©ì ì•ˆë‚´</p>
                <p>ìë™ ì´ë™ì´ ì•ˆ ë  ê²½ìš°,<br>í•˜ë‹¨ <b>[ ï¼ ]</b> ë˜ëŠ” <b>[ â†‘ ]</b> ë²„íŠ¼ì„ ëˆŒëŸ¬<br><b>[Safarië¡œ ì—´ê¸°]</b>ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!</p>
            </div>
        </div>

        <div id="iphoneSection" class="content-section">
            <p>ğŸ <b>ì•„ì´í° ì „ìš© ìë™ì„¤ì¹˜</b></p>
            <button id="installProfile" class="big-btn">ì•„ì´í° ë°”ë¡œê°€ê¸° ì„¤ì¹˜í•˜ê¸°</button>
            <p id="guideText" class="small-text" style="color:red; font-weight:bold;">
                [í—ˆìš©] í´ë¦­ í›„ [ì„¤ì •] ì•± ë§¨ ìœ„ì—ì„œ<br>
                'ë‹¤ìš´ë¡œë“œëœ í”„ë¡œíŒŒì¼'ì„ ëˆŒëŸ¬ ì„¤ì¹˜í•˜ì„¸ìš”!
            </p>
        </div>
    </div>

    <script>
        const CAFE_URL = "https://cafe.naver.com/truckerking"; 
        
        // [ì¤‘ìš”] ë°±í‹±( ` ) ì‚¬ì´ì— ë°ì´í„°ë¥¼ ë„£ìœ¼ì„¸ìš”
        const iconRaw = `ì—¬ê¸°ì—_ë°ì´í„°_ì…ë ¥`;

        window.addEventListener('load', () => {
            const userAgent = navigator.userAgent.toLowerCase();
            const isIos = /iphone|ipad|ipod/.test(userAgent);
            const isNaverApp = userAgent.indexOf('naver') !== -1;
            const isKakaoApp = userAgent.indexOf('kakao') !== -1;
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

            if (isStandalone) { window.location.replace(CAFE_URL); return; }

            // 1. ì•„ì´í°ì¸ë° ë„¤ì´ë²„ë‚˜ ì¹´í†¡ ì•±ì¼ ë•Œ (ì‚¬íŒŒë¦¬ íƒˆì¶œ ì‹œë„)
            if (isIos && (isNaverApp || isKakaoApp)) {
                // ì‚¬íŒŒë¦¬ ê°•ì œ í˜¸ì¶œ ì£¼ì†Œ (x-safari-https://)
                const safariJumpUrl = "x-safari-https://" + window.location.host + window.location.pathname;
                location.href = safariJumpUrl;

                // í˜¹ì‹œ ì•ˆ ë„˜ì–´ê°ˆ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì•ˆë‚´ í™”ë©´ í‘œì‹œ
                document.getElementById('naverSection').style.display = 'block';
                document.getElementById('iosInAppNotice').style.display = 'block';
                document.getElementById('appNotice').style.display = 'none';
                document.getElementById('goToChrome').style.display = 'none';
            } 
            // 2. ì•„ì´í° ì‚¬íŒŒë¦¬ì¼ ë•Œ
            else if (isIos) {
                document.getElementById('iphoneSection').style.display = 'block';
            } 
            // 3. ì•ˆë“œë¡œì´ë“œ ë„¤ì´ë²„ ì•±ì¼ ë•Œ
            else if (isNaverApp) {
                document.getElementById('naverSection').style.display = 'block';
            } 
            // 4. ì•ˆë“œë¡œì´ë“œ ì¼ë°˜ ë¸Œë¼ìš°ì €(í¬ë¡¬ ë“±)
            else {
                document.getElementById('androidSection').style.display = 'block';
            }
        });

        // --- ì•„ì´í° í”„ë¡œíŒŒì¼ ì„¤ì¹˜ ì‹¤í–‰ ë¡œì§ ---
        document.getElementById('installProfile').onclick = function() {
            const cleanBase64 = iconRaw.replace(/[^A-Za-z0-9+/=]/g, "");
            const genUUID = () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });

            const profileContent = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>PayloadContent</key>
    <array>
        <dict>
            <key>FullScreen</key><true/>
            <key>IsRemovable</key><true/>
            <key>Label</key><string>ì˜ìš´ëª¨</string>
            <key>PayloadDisplayName</key><string>ì˜ìš´ëª¨</string>
            <key>PayloadIdentifier</key><string>com.youngunmo.shortcut</string>
            <key>PayloadType</key><string>com.apple.webClip.managed</string>
            <key>PayloadUUID</key><string>${genUUID()}</string>
            <key>PayloadVersion</key><integer>1</integer>
            <key>URL</key><string>${CAFE_URL}</string>
            <key>Icon</key><data>${cleanBase64}</data>
        </dict>
    </array>
    <key>PayloadDisplayName</key><string>ì˜ìš´ëª¨ ë°”ë¡œê°€ê¸° ì„¤ì¹˜</string>
    <key>PayloadIdentifier</key><string>com.youngunmo.profile</string>
    <key>PayloadType</key><string>Configuration</string>
    <key>PayloadUUID</key><string>${genUUID()}</string>
    <key>PayloadVersion</key><integer>1</integer>
</dict>
</plist>`;

            const blob = new Blob([profileContent], { type: 'application/x-apple-aspen-config' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'youngunmo.mobileconfig';
            document.body.appendChild(a);
            a.click();
            
            document.getElementById('guideText').innerHTML = "âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!<br>[ì„¤ì •] ì•±ì—ì„œ ì„¤ì¹˜ë¥¼ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”!";
            setTimeout(() => { window.URL.revokeObjectURL(url); document.body.removeChild(a); }, 1000);
        };

        // ì•ˆë“œë¡œì´ë“œ ë„¤ì´ë²„ ì•± -> í¬ë¡¬ ì´ë™
        document.getElementById('goToChrome').onclick = () => {
            location.href = "intent://" + location.host + location.pathname + "#Intent;scheme=https;package=com.android.chrome;end";
        };

        // ì•ˆë“œë¡œì´ë“œ PWA ì„¤ì¹˜
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
        document.getElementById('installButton').onclick = () => {
            if (deferredPrompt) { deferredPrompt.prompt(); } 
            else { alert("í¬ë¡¬ ë©”ë‰´ì—ì„œ 'í™ˆ í™”ë©´ì— ì¶”ê°€'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”."); }
        };
    </script>
</body>
</html>

